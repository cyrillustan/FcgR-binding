<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="64,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1U3">J</span>, <span class="var type1" id="S3T8U4">mfiExp</span>, <span class="var type1" id="S4T9U5">mfiExpPre</span>] = Error(<span class="var type1" id="S5T19U8">Rtot</span>, <span class="var type1" id="S6T3U9">Kd</span>, <span class="var type1" id="S7T4U10">mfiAdjMean</span>, <span class="var type1" id="S8T6U11">v</span>, <span class="var type1" id="S9T5U12">biCoefMat</span>, <span class="var type1" id="S10T6U13">tnpbsa</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="64,2" id="srcline2"> 2</a></span><span class="line">    <span class="comment">%Convert from log scale</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,3" id="srcline3"> 3</a></span><span class="line">    <span class="mxinfo " id="T19:U10"><span class="var type1" id="S5T19U16">Rtot</span> = <span class="mxinfo " id="T19:U12"><span class="mxinfo " id="T1:U13">10</span>.^<span class="var type1" id="S5T19U19">Rtot</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,4" id="srcline4"> 4</a></span><span class="line">    <span class="mxinfo " id="T1:U15"><span class="var type1" id="S11T1U22">Kx</span> = <span class="mxinfo " id="T1:U17"><span class="var type1" id="S5T19U24">Rtot</span>(<span class="mxinfo " id="T12:U19">7</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,5" id="srcline5"> 5</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="64,6" id="srcline6"> 6</a></span><span class="line">    <span class="comment">%Get expected value of MFIs (before conversion factors) from Equation 7</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,7" id="srcline7"> 7</a></span><span class="line">    <span class="comment">%from Stone</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,8" id="srcline8"> 8</a></span><span class="line">    <span class="mxinfo " id="T9:U20"><span class="var type1" id="S12T9U28">mfiExpPrePre</span> = <span class="mxinfo " id="T9:U22">zeros(<span class="mxinfo " id="T1:U23">6</span>,<span class="mxinfo " id="T1:U24">8</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,9" id="srcline9"> 9</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S14T1U35">j</span> = <span class="mxinfo " id="T1:U26">1</span>:6</span></span>
<span class="srcline"><span class="lineno"><a href="64,10" id="srcline10">10</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S15T1U41">k</span> = <span class="mxinfo " id="T1:U28">1</span>:4</span></span>
<span class="srcline"><span class="lineno"><a href="64,11" id="srcline11">11</a></span><span class="line">            <span class="mxinfo " id="T1:U29"><span class="mxinfo " id="T1:U30"><span class="var type1" id="S12T9U48">mfiExpPrePre</span>(<span class="var type1" id="S14T1U49">j</span>,<span class="var type1" id="S15T1U50">k</span>)</span> = <span class="mxinfo " id="T1:U34"><span class="fcn" id="F156N6:B52">StoneSolver</span>(<span class="mxinfo " id="T1:U35"><span class="var type1" id="S5T19U54">Rtot</span>(<span class="var type1" id="S14T1U55">j</span>)</span>,<span class="var type1" id="S11T1U56">Kx</span>,<span class="mxinfo " id="T1:U39"><span class="var type1" id="S8T6U58">v</span>(<span class="mxinfo " id="T12:U41">1</span>)</span>,<span class="mxinfo " id="T1:U42"><span class="var type1" id="S6T3U61">Kd</span>(<span class="var type1" id="S14T1U62">j</span>,<span class="var type1" id="S15T1U63">k</span>)</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,12" id="srcline12">12</a></span><span class="line">                <span class="mxinfo " id="T1:U46"><span class="var type1" id="S10T6U65">tnpbsa</span>(<span class="mxinfo " id="T12:U48">1</span>)</span>,<span class="var type1" id="S9T5U67">biCoefMat</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,13" id="srcline13">13</a></span><span class="line">            <span class="mxinfo " id="T1:U50"><span class="mxinfo " id="T1:U51"><span class="var type1" id="S12T9U71">mfiExpPrePre</span>(<span class="var type1" id="S14T1U72">j</span>,<span class="mxinfo " id="T1:U54"><span class="var type1" id="S15T1U74">k</span>+<span class="mxinfo " id="T1:U56">4</span></span>)</span> = <span class="mxinfo " id="T1:U57"><span class="fcn" id="F156N6:B77">StoneSolver</span>(<span class="mxinfo " id="T1:U58"><span class="var type1" id="S5T19U79">Rtot</span>(<span class="var type1" id="S14T1U80">j</span>)</span>,<span class="var type1" id="S11T1U81">Kx</span>,<span class="mxinfo " id="T1:U62"><span class="var type1" id="S8T6U83">v</span>(<span class="mxinfo " id="T12:U64">2</span>)</span>,<span class="mxinfo " id="T1:U65"><span class="var type1" id="S6T3U86">Kd</span>(<span class="var type1" id="S14T1U87">j</span>,<span class="var type1" id="S15T1U88">k</span>)</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,14" id="srcline14">14</a></span><span class="line">                <span class="mxinfo " id="T1:U69"><span class="var type1" id="S10T6U90">tnpbsa</span>(<span class="mxinfo " id="T12:U71">2</span>)</span>,<span class="var type1" id="S9T5U92">biCoefMat</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,15" id="srcline15">15</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,16" id="srcline16">16</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,17" id="srcline17">17</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="64,18" id="srcline18">18</a></span><span class="line">    <span class="comment">%Multiply by conversion factors</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,19" id="srcline19">19</a></span><span class="line">    <span class="mxinfo " id="T9:U73"><span class="var type1" id="S4T9U95">mfiExpPre</span> = <span class="mxinfo " id="T9:U75"><span class="mxinfo " id="T1:U76"><span class="var type1" id="S5T19U98">Rtot</span>(<span class="mxinfo " id="T12:U78">8</span>)</span>*<span class="var type1" id="S12T9U100">mfiExpPrePre</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,20" id="srcline20">20</a></span><span class="line">    <span class="mxinfo " id="T3:U80"><span class="mxinfo " id="T3:U81"><span class="var type1" id="S4T9U104">mfiExpPre</span>(<span class="mxinfo " id="T53:U83">:</span>,<span class="mxinfo " id="T54:U84">5:8</span>)</span> = <span class="mxinfo " id="T3:U85"><span class="mxinfo " id="T1:U86"><span class="var type1" id="S5T19U111">Rtot</span>(<span class="mxinfo " id="T12:U88">9</span>)</span>*<span class="mxinfo " id="T3:U89"><span class="var type1" id="S12T9U114">mfiExpPrePre</span>(<span class="mxinfo " id="T53:U91">:</span>,<span class="mxinfo " id="T54:U92">5:8</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,21" id="srcline21">21</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="64,22" id="srcline22">22</a></span><span class="line">    <span class="comment">%Check for undefined values (errors from ReqFuncSolver)</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,23" id="srcline23">23</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T11:U93">max(<span class="mxinfo " id="T49:U94">max(<span class="mxinfo " id="T46:U95"><span class="var type1" id="S4T9U126">mfiExpPre</span> == <span class="mxinfo " id="T1:U97">-<span class="mxinfo " id="T1:U98">1</span></span></span>)</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,24" id="srcline24">24</a></span><span class="line">        <span class="mxinfo " id="T1:U99"><span class="var type1" id="S2T1U131">J</span> = <span class="mxinfo " id="T1:U101">1e8</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,25" id="srcline25">25</a></span><span class="line">        <span class="mxinfo " id="T9:U102"><span class="var type1" id="S4T9U135">mfiExpPre</span> = <span class="mxinfo " id="T9:U104">-<span class="mxinfo " id="T9:U105">ones(<span class="mxinfo " id="T1:U106">6</span>,<span class="mxinfo " id="T1:U107">8</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,26" id="srcline26">26</a></span><span class="line">        <span class="mxinfo " id="T8:U108"><span class="var type1" id="S3T8U143">mfiExp</span> = <span class="mxinfo " id="T9:U110">-<span class="mxinfo " id="T9:U111">ones(<span class="mxinfo " id="T1:U112">6</span>,<span class="mxinfo " id="T1:U113">8</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,27" id="srcline27">27</a></span><span class="line">        <span class="keyword">return</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,28" id="srcline28">28</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,29" id="srcline29">29</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="64,30" id="srcline30">30</a></span><span class="line">    <span class="comment">%Create array of expected values to calculate residuals</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,31" id="srcline31">31</a></span><span class="line">    <span class="mxinfo " id="T8:U114"><span class="var type1" id="S3T8U152">mfiExp</span> = <span class="mxinfo " id="T4:U116">zeros(<span class="mxinfo " id="T1:U117">24</span>,<span class="mxinfo " id="T1:U118">8</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,32" id="srcline32">32</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S14T1U159">j</span> = <span class="mxinfo " id="T1:U120">1</span>:6</span></span>
<span class="srcline"><span class="lineno"><a href="64,33" id="srcline33">33</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S15T1U165">k</span> = <span class="mxinfo " id="T1:U122">1</span>:4</span></span>
<span class="srcline"><span class="lineno"><a href="64,34" id="srcline34">34</a></span><span class="line">            <span class="mxinfo " id="T51:U123"><span class="mxinfo " id="T51:U124"><span class="var type1" id="S3T8U172">mfiExp</span>((<span class="mxinfo " id="T1:U126"><span class="mxinfo " id="T1:U127"><span class="mxinfo " id="T1:U128">4</span>*(<span class="mxinfo " id="T1:U129"><span class="var type1" id="S14T1U179">j</span>-<span class="mxinfo " id="T1:U131">1</span></span>)</span>+<span class="var type1" id="S15T1U181">k</span></span>),<span class="mxinfo " id="T51:U133"><span class="mxinfo " id="T1:U134">1</span>:<span class="mxinfo " id="T1:U135">4</span></span>)</span> = <span class="mxinfo " id="T51:U136"><span class="mxinfo " id="T1:U137"><span class="var type1" id="S4T9U187">mfiExpPre</span>(<span class="var type1" id="S14T1U188">j</span>,<span class="var type1" id="S15T1U189">k</span>)</span>*<span class="mxinfo " id="T51:U141">ones(1,4)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,35" id="srcline35">35</a></span><span class="line">            <span class="mxinfo " id="T51:U142"><span class="mxinfo " id="T51:U143"><span class="var type1" id="S3T8U197">mfiExp</span>((<span class="mxinfo " id="T1:U145"><span class="mxinfo " id="T1:U146"><span class="mxinfo " id="T1:U147">4</span>*(<span class="mxinfo " id="T1:U148"><span class="var type1" id="S14T1U204">j</span>-<span class="mxinfo " id="T1:U150">1</span></span>)</span>+<span class="var type1" id="S15T1U206">k</span></span>),<span class="mxinfo " id="T51:U152"><span class="mxinfo " id="T1:U153">5</span>:<span class="mxinfo " id="T1:U154">8</span></span>)</span> = <span class="mxinfo " id="T51:U155"><span class="mxinfo " id="T1:U156"><span class="var type1" id="S4T9U212">mfiExpPre</span>(<span class="var type1" id="S14T1U213">j</span>,<span class="mxinfo " id="T1:U159"><span class="var type1" id="S15T1U215">k</span>+<span class="mxinfo " id="T1:U161">4</span></span>)</span>*<span class="mxinfo " id="T51:U162">ones(1,4)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,36" id="srcline36">36</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,37" id="srcline37">37</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,38" id="srcline38">38</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="64,39" id="srcline39">39</a></span><span class="line">    <span class="comment">%Error</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,40" id="srcline40">40</a></span><span class="line">    <span class="mxinfo " id="T1:U163"><span class="var type1" id="S2T1U223">J</span> = <span class="mxinfo " id="T1:U165">nansum(<span class="mxinfo " id="T52:U166">nansum(<span class="mxinfo " id="T4:U167">(<span class="mxinfo " id="T4:U168"><span class="var type1" id="S3T8U231">mfiExp</span>-<span class="var type1" id="S7T4U232">mfiAdjMean</span></span>).^2</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,41" id="srcline41">41</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
