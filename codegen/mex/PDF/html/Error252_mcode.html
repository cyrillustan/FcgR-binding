<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="64,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1U3">J</span>, <span class="var type1" id="S3T7U4">mfiExp</span>, <span class="var type1" id="S4T8U5">mfiExpPre</span>] = Error(<span class="var type1" id="S5T19U8">Rtot</span>, <span class="var type1" id="S6T3U9">Kd</span>, <span class="var type1" id="S7T4U10">mfiAdjMean</span>, <span class="var type1" id="S8T12U11">v</span>, <span class="var type1" id="S9T5U12">biCoefMat</span>, <span class="var type1" id="S10T1U13">tnpbsa</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="64,2" id="srcline2"> 2</a></span><span class="line">    <span class="comment">%Convert from log scale</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,3" id="srcline3"> 3</a></span><span class="line">    <span class="mxinfo " id="T19:U10"><span class="var type1" id="S5T19U16">Rtot</span> = <span class="mxinfo " id="T19:U12"><span class="mxinfo " id="T1:U13">10</span>.^<span class="var type1" id="S5T19U19">Rtot</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,4" id="srcline4"> 4</a></span><span class="line">    <span class="mxinfo " id="T1:U15"><span class="var type1" id="S11T1U22">Kx</span> = <span class="mxinfo " id="T1:U17"><span class="var type1" id="S5T19U24">Rtot</span>(<span class="mxinfo " id="T11:U19">7</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,5" id="srcline5"> 5</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="64,6" id="srcline6"> 6</a></span><span class="line">    <span class="comment">%Get expected value of MFIs (before conversion factors) from Equation 7</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,7" id="srcline7"> 7</a></span><span class="line">    <span class="comment">%from Stone</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,8" id="srcline8"> 8</a></span><span class="line">    <span class="mxinfo " id="T8:U20"><span class="var type1" id="S12T8U28">mfiExpPrePre</span> = <span class="mxinfo " id="T8:U22">zeros(<span class="mxinfo " id="T1:U23">6</span>,<span class="mxinfo " id="T1:U24">8</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,9" id="srcline9"> 9</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S14T1U35">j</span> = <span class="mxinfo " id="T1:U26">1</span>:6</span></span>
<span class="srcline"><span class="lineno"><a href="64,10" id="srcline10">10</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S15T1U41">k</span> = <span class="mxinfo " id="T1:U28">1</span>:4</span></span>
<span class="srcline"><span class="lineno"><a href="64,11" id="srcline11">11</a></span><span class="line">            <span class="mxinfo " id="T1:U29"><span class="mxinfo " id="T1:U30"><span class="var type1" id="S12T8U48">mfiExpPrePre</span>(<span class="var type1" id="S14T1U49">j</span>,<span class="var type1" id="S15T1U50">k</span>)</span> = <span class="mxinfo " id="T1:U34"><span class="fcn" id="F157N6:B52">StoneSolver</span>(<span class="mxinfo " id="T1:U35"><span class="var type1" id="S5T19U54">Rtot</span>(<span class="var type1" id="S14T1U55">j</span>)</span>,<span class="var type1" id="S11T1U56">Kx</span>,<span class="mxinfo " id="T1:U39"><span class="var type1" id="S8T12U58">v</span>(<span class="mxinfo " id="T11:U41">1</span>)</span>,<span class="mxinfo " id="T1:U42"><span class="var type1" id="S6T3U61">Kd</span>(<span class="var type1" id="S14T1U62">j</span>,<span class="var type1" id="S15T1U63">k</span>)</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,12" id="srcline12">12</a></span><span class="line">                <span class="var type1" id="S10T1U64">tnpbsa</span>,<span class="var type1" id="S9T5U65">biCoefMat</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,13" id="srcline13">13</a></span><span class="line">            <span class="mxinfo " id="T1:U48"><span class="mxinfo " id="T1:U49"><span class="var type1" id="S12T8U69">mfiExpPrePre</span>(<span class="var type1" id="S14T1U70">j</span>,<span class="mxinfo " id="T1:U52"><span class="var type1" id="S15T1U72">k</span>+<span class="mxinfo " id="T1:U54">4</span></span>)</span> = <span class="mxinfo " id="T1:U55"><span class="fcn" id="F157N6:B75">StoneSolver</span>(<span class="mxinfo " id="T1:U56"><span class="var type1" id="S5T19U77">Rtot</span>(<span class="var type1" id="S14T1U78">j</span>)</span>,<span class="var type1" id="S11T1U79">Kx</span>,<span class="mxinfo " id="T1:U60"><span class="var type1" id="S8T12U81">v</span>(<span class="mxinfo " id="T11:U62">2</span>)</span>,<span class="mxinfo " id="T1:U63"><span class="var type1" id="S6T3U84">Kd</span>(<span class="var type1" id="S14T1U85">j</span>,<span class="var type1" id="S15T1U86">k</span>)</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,14" id="srcline14">14</a></span><span class="line">                <span class="var type1" id="S10T1U87">tnpbsa</span>,<span class="var type1" id="S9T5U88">biCoefMat</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,15" id="srcline15">15</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,16" id="srcline16">16</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,17" id="srcline17">17</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="64,18" id="srcline18">18</a></span><span class="line">    <span class="comment">%Multiply by conversion factors</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,19" id="srcline19">19</a></span><span class="line">    <span class="mxinfo " id="T8:U69"><span class="var type1" id="S4T8U91">mfiExpPre</span> = <span class="mxinfo " id="T8:U71"><span class="mxinfo " id="T1:U72"><span class="var type1" id="S5T19U94">Rtot</span>(<span class="mxinfo " id="T11:U74">8</span>)</span>*<span class="var type1" id="S12T8U96">mfiExpPrePre</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,20" id="srcline20">20</a></span><span class="line">    <span class="mxinfo " id="T45:U76"><span class="mxinfo " id="T45:U77"><span class="var type1" id="S4T8U100">mfiExpPre</span>(<span class="mxinfo " id="T53:U79">:</span>,<span class="mxinfo " id="T54:U80">5:8</span>)</span> = <span class="mxinfo " id="T45:U81"><span class="mxinfo " id="T1:U82"><span class="var type1" id="S5T19U107">Rtot</span>(<span class="mxinfo " id="T11:U84">9</span>)</span>*<span class="mxinfo " id="T45:U85"><span class="var type1" id="S12T8U110">mfiExpPrePre</span>(<span class="mxinfo " id="T53:U87">:</span>,<span class="mxinfo " id="T54:U88">5:8</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,21" id="srcline21">21</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="64,22" id="srcline22">22</a></span><span class="line">    <span class="comment">%Check for undefined values (errors from ReqFuncSolver)</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,23" id="srcline23">23</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T10:U89">max(<span class="mxinfo " id="T49:U90">max(<span class="mxinfo " id="T46:U91"><span class="var type1" id="S4T8U122">mfiExpPre</span> == <span class="mxinfo " id="T1:U93">-<span class="mxinfo " id="T1:U94">1</span></span></span>)</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,24" id="srcline24">24</a></span><span class="line">        <span class="mxinfo " id="T1:U95"><span class="var type1" id="S2T1U127">J</span> = <span class="mxinfo " id="T1:U97">1e8</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,25" id="srcline25">25</a></span><span class="line">        <span class="mxinfo " id="T8:U98"><span class="var type1" id="S4T8U131">mfiExpPre</span> = <span class="mxinfo " id="T8:U100">-<span class="mxinfo " id="T8:U101">ones(<span class="mxinfo " id="T1:U102">6</span>,<span class="mxinfo " id="T1:U103">8</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,26" id="srcline26">26</a></span><span class="line">        <span class="mxinfo " id="T7:U104"><span class="var type1" id="S3T7U139">mfiExp</span> = <span class="mxinfo " id="T8:U106">-<span class="mxinfo " id="T8:U107">ones(<span class="mxinfo " id="T1:U108">6</span>,<span class="mxinfo " id="T1:U109">8</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,27" id="srcline27">27</a></span><span class="line">        <span class="keyword">return</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,28" id="srcline28">28</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,29" id="srcline29">29</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="64,30" id="srcline30">30</a></span><span class="line">    <span class="comment">%Create array of expected values to calculate residuals</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,31" id="srcline31">31</a></span><span class="line">    <span class="mxinfo " id="T7:U110"><span class="var type1" id="S3T7U148">mfiExp</span> = <span class="mxinfo " id="T4:U112">zeros(<span class="mxinfo " id="T1:U113">24</span>,<span class="mxinfo " id="T1:U114">8</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,32" id="srcline32">32</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S14T1U155">j</span> = <span class="mxinfo " id="T1:U116">1</span>:6</span></span>
<span class="srcline"><span class="lineno"><a href="64,33" id="srcline33">33</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S15T1U161">k</span> = <span class="mxinfo " id="T1:U118">1</span>:4</span></span>
<span class="srcline"><span class="lineno"><a href="64,34" id="srcline34">34</a></span><span class="line">            <span class="mxinfo " id="T51:U119"><span class="mxinfo " id="T51:U120"><span class="var type1" id="S3T7U168">mfiExp</span>((<span class="mxinfo " id="T1:U122"><span class="mxinfo " id="T1:U123"><span class="mxinfo " id="T1:U124">4</span>*(<span class="mxinfo " id="T1:U125"><span class="var type1" id="S14T1U175">j</span>-<span class="mxinfo " id="T1:U127">1</span></span>)</span>+<span class="var type1" id="S15T1U177">k</span></span>),<span class="mxinfo " id="T51:U129"><span class="mxinfo " id="T1:U130">1</span>:<span class="mxinfo " id="T1:U131">4</span></span>)</span> = <span class="mxinfo " id="T51:U132"><span class="mxinfo " id="T1:U133"><span class="var type1" id="S4T8U183">mfiExpPre</span>(<span class="var type1" id="S14T1U184">j</span>,<span class="var type1" id="S15T1U185">k</span>)</span>*<span class="mxinfo " id="T51:U137">ones(1,4)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,35" id="srcline35">35</a></span><span class="line">            <span class="mxinfo " id="T51:U138"><span class="mxinfo " id="T51:U139"><span class="var type1" id="S3T7U193">mfiExp</span>((<span class="mxinfo " id="T1:U141"><span class="mxinfo " id="T1:U142"><span class="mxinfo " id="T1:U143">4</span>*(<span class="mxinfo " id="T1:U144"><span class="var type1" id="S14T1U200">j</span>-<span class="mxinfo " id="T1:U146">1</span></span>)</span>+<span class="var type1" id="S15T1U202">k</span></span>),<span class="mxinfo " id="T51:U148"><span class="mxinfo " id="T1:U149">5</span>:<span class="mxinfo " id="T1:U150">8</span></span>)</span> = <span class="mxinfo " id="T51:U151"><span class="mxinfo " id="T1:U152"><span class="var type1" id="S4T8U208">mfiExpPre</span>(<span class="var type1" id="S14T1U209">j</span>,<span class="mxinfo " id="T1:U155"><span class="var type1" id="S15T1U211">k</span>+<span class="mxinfo " id="T1:U157">4</span></span>)</span>*<span class="mxinfo " id="T51:U158">ones(1,4)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,36" id="srcline36">36</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,37" id="srcline37">37</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,38" id="srcline38">38</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="64,39" id="srcline39">39</a></span><span class="line">    <span class="comment">%Error</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,40" id="srcline40">40</a></span><span class="line">    <span class="mxinfo " id="T1:U159"><span class="var type1" id="S2T1U219">J</span> = <span class="mxinfo " id="T1:U161">nansum(<span class="mxinfo " id="T52:U162">nansum(<span class="mxinfo " id="T4:U163">(<span class="mxinfo " id="T4:U164"><span class="var type1" id="S3T7U227">mfiExp</span>-<span class="var type1" id="S7T4U228">mfiAdjMean</span></span>).^2</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,41" id="srcline41">41</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
