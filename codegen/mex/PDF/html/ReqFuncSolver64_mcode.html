<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="21,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> <span class="mxinfo " id="T1:U1"><span class="var type1" id="S2T1U3"><span class="message error" id="M10F64C">x</span></span></span> = ReqFuncSolver(<span class="var type1" id="S3T1U6">R</span>, <span class="var type1" id="S4T1U7">kdi</span>, <span class="var type1" id="S5T1U8">Li</span>, <span class="var type1" id="S6T1U9">vi</span>, <span class="var type1" id="S7T1U10">kx</span>, <span class="var type2" id="S8T1V1U11">a</span>, <span class="var type2" id="S9T1V2U12">b</span>, <span class="var type2" id="S10T1V3U13">error</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="21,2" id="srcline2"> 2</a></span><span class="line">    <span class="comment">%%%This function uses the bisection algorithm so solve the equation</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,3" id="srcline3"> 3</a></span><span class="line">    <span class="comment">%%%represented by the anonymous function ReqFunc in Error.</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,4" id="srcline4"> 4</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="21,5" id="srcline5"> 5</a></span><span class="line">    <span class="comment">%Check that the first point on the interval is less than the second, </span></span></span>
<span class="srcline"><span class="lineno"><a href="21,6" id="srcline6"> 6</a></span><span class="line">    <span class="comment">%that fun(a)*fun(b) is negative, and that error is positive. If not, </span></span></span>
<span class="srcline"><span class="lineno"><a href="21,7" id="srcline7"> 7</a></span><span class="line">    <span class="comment">%return an imaginary number.</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,8" id="srcline8"> 8</a></span><span class="line">    <span class="keyword">if</span> <span class="var type1" id="S8T1U19">a</span> &gt;= <span class="var type1" id="S9T1U20">b</span> || <span class="mxinfo " id="T16:U12"><span class="mxinfo " id="T1:U13">(<span class="mxinfo " id="T1:U14"><span class="var type1" id="S3T1U25">R</span> - <span class="mxinfo " id="T1:U16"><span class="var type1" id="S8T1U27">a</span>*(<span class="mxinfo " id="T1:U18"><span class="mxinfo " id="T1:U19">1</span>+<span class="mxinfo " id="T1:U20"><span class="mxinfo " id="T1:U21"><span class="mxinfo " id="T1:U22"><span class="var type1" id="S6T1U34">vi</span>*<span class="var type1" id="S5T1U35">Li</span></span>/<span class="var type1" id="S4T1U36">kdi</span></span>*<span class="mxinfo " id="T1:U26">(<span class="mxinfo " id="T1:U27"><span class="mxinfo " id="T1:U28">1</span>+<span class="mxinfo " id="T1:U29"><span class="var type1" id="S7T1U42">kx</span>*<span class="var type1" id="S8T1U43">a</span></span></span>)^(<span class="mxinfo " id="T1:U32"><span class="var type1" id="S6T1U46">vi</span>-<span class="mxinfo " id="T1:U34">1</span></span>)</span></span></span>)</span></span>)*(<span class="mxinfo " id="T1:U35"><span class="var type1" id="S3T1U50">R</span> - <span class="mxinfo " id="T1:U37"><span class="var type1" id="S9T1U52">b</span>*(<span class="mxinfo " id="T1:U39"><span class="mxinfo " id="T1:U40">1</span>+<span class="mxinfo " id="T1:U41"><span class="mxinfo " id="T1:U42"><span class="mxinfo " id="T1:U43"><span class="var type1" id="S6T1U59">vi</span>*<span class="var type1" id="S5T1U60">Li</span></span>/<span class="var type1" id="S4T1U61">kdi</span></span>*<span class="mxinfo " id="T1:U47">(<span class="mxinfo " id="T1:U48"><span class="mxinfo " id="T1:U49">1</span>+<span class="mxinfo " id="T1:U50"><span class="var type1" id="S7T1U67">kx</span>*<span class="var type1" id="S9T1U68">b</span></span></span>)^(<span class="mxinfo " id="T1:U53"><span class="var type1" id="S6T1U71">vi</span>-<span class="mxinfo " id="T1:U55">1</span></span>)</span></span></span>)</span></span>)</span> &gt;= <span class="mxinfo " id="T1:U56">0</span></span> <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,9" id="srcline9"> 9</a></span><span class="line">            || <span class="var type1" id="S10T1U75">error</span> &lt;= 0</span></span>
<span class="srcline"><span class="lineno"><a href="21,10" id="srcline10">10</a></span><span class="line">        <span class="mxinfo " id="T1:U58"><span class="var type1" id="S2T1U79">x</span> = <span class="mxinfo " id="T1:U60">NaN</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="21,11" id="srcline11">11</a></span><span class="line">        <span class="keyword">return</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,12" id="srcline12">12</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,13" id="srcline13">13</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="21,14" id="srcline14">14</a></span><span class="line">    <span class="comment">%Commence algorithm</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,15" id="srcline15">15</a></span><span class="line">    <span class="mxinfo " id="T1:U61"><span class="var type1" id="S12T1U85">condition</span> = <span class="mxinfo " id="T1:U63">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="21,16" id="srcline16">16</a></span><span class="line">    <span class="keyword">while</span> <span class="mxinfo " id="T16:U64"><span class="var type1" id="S12T1U89">condition</span> == <span class="mxinfo " id="T1:U66">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="21,17" id="srcline17">17</a></span><span class="line">        <span class="mxinfo " id="T1:U67"><span class="var type1" id="S13T1U93">c</span> = <span class="mxinfo " id="T1:U69">(<span class="mxinfo " id="T1:U70"><span class="var type1" id="S8T1U97">a</span>+<span class="var type1" id="S9T1U98">b</span></span>)/<span class="mxinfo " id="T1:U73">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="21,18" id="srcline18">18</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T16:U74"><span class="mxinfo " id="T1:U75">abs(<span class="mxinfo " id="T1:U76"><span class="var type1" id="S3T1U106">R</span> - <span class="mxinfo " id="T1:U78"><span class="var type1" id="S13T1U108">c</span>*(<span class="mxinfo " id="T1:U80"><span class="mxinfo " id="T1:U81">1</span>+<span class="mxinfo " id="T1:U82"><span class="mxinfo " id="T1:U83"><span class="mxinfo " id="T1:U84"><span class="var type1" id="S6T1U115">vi</span>*<span class="var type1" id="S5T1U116">Li</span></span>/<span class="var type1" id="S4T1U117">kdi</span></span>*<span class="mxinfo " id="T1:U88">(<span class="mxinfo " id="T1:U89"><span class="mxinfo " id="T1:U90">1</span>+<span class="mxinfo " id="T1:U91"><span class="var type1" id="S7T1U123">kx</span>*<span class="var type1" id="S13T1U124">c</span></span></span>)^(<span class="mxinfo " id="T1:U94"><span class="var type1" id="S6T1U127">vi</span>-<span class="mxinfo " id="T1:U96">1</span></span>)</span></span></span>)</span></span>)</span> &lt; <span class="var type1" id="S10T1U129">error</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="21,19" id="srcline19">19</a></span><span class="line">            <span class="mxinfo " id="T1:U98"><span class="var type1" id="S12T1U132">condition</span> = <span class="mxinfo " id="T1:U100">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="21,20" id="srcline20">20</a></span><span class="line">            <span class="mxinfo " id="T1:U101"><span class="var type1" id="S2T1U136">x</span> = <span class="var type1" id="S13T1U137">c</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="21,21" id="srcline21">21</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,22" id="srcline22">22</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T16:U104"><span class="mxinfo " id="T1:U105">(<span class="mxinfo " id="T1:U106"><span class="var type1" id="S3T1U144">R</span> - <span class="mxinfo " id="T1:U108"><span class="var type1" id="S13T1U146">c</span>*(<span class="mxinfo " id="T1:U110"><span class="mxinfo " id="T1:U111">1</span>+<span class="mxinfo " id="T1:U112"><span class="mxinfo " id="T1:U113"><span class="mxinfo " id="T1:U114"><span class="var type1" id="S6T1U153">vi</span>*<span class="var type1" id="S5T1U154">Li</span></span>/<span class="var type1" id="S4T1U155">kdi</span></span>*<span class="mxinfo " id="T1:U118">(<span class="mxinfo " id="T1:U119"><span class="mxinfo " id="T1:U120">1</span>+<span class="mxinfo " id="T1:U121"><span class="var type1" id="S7T1U161">kx</span>*<span class="var type1" id="S13T1U162">c</span></span></span>)^(<span class="mxinfo " id="T1:U124"><span class="var type1" id="S6T1U165">vi</span>-<span class="mxinfo " id="T1:U126">1</span></span>)</span></span></span>)</span></span>)*(<span class="mxinfo " id="T1:U127"><span class="var type1" id="S3T1U169">R</span> - <span class="mxinfo " id="T1:U129"><span class="var type1" id="S9T1U171">b</span>*(<span class="mxinfo " id="T1:U131"><span class="mxinfo " id="T1:U132">1</span>+<span class="mxinfo " id="T1:U133"><span class="mxinfo " id="T1:U134"><span class="mxinfo " id="T1:U135"><span class="var type1" id="S6T1U178">vi</span>*<span class="var type1" id="S5T1U179">Li</span></span>/<span class="var type1" id="S4T1U180">kdi</span></span>*<span class="mxinfo " id="T1:U139">(<span class="mxinfo " id="T1:U140"><span class="mxinfo " id="T1:U141">1</span>+<span class="mxinfo " id="T1:U142"><span class="var type1" id="S7T1U186">kx</span>*<span class="var type1" id="S9T1U187">b</span></span></span>)^(<span class="mxinfo " id="T1:U145"><span class="var type1" id="S6T1U190">vi</span>-<span class="mxinfo " id="T1:U147">1</span></span>)</span></span></span>)</span></span>)</span> &gt;= <span class="mxinfo " id="T1:U148">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="21,23" id="srcline23">23</a></span><span class="line">            <span class="mxinfo " id="T1:U149"><span class="var type1" id="S9T1U195">b</span> = <span class="var type1" id="S13T1U196">c</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="21,24" id="srcline24">24</a></span><span class="line">        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,25" id="srcline25">25</a></span><span class="line">            <span class="mxinfo " id="T1:U152"><span class="var type1" id="S8T1U200">a</span> = <span class="var type1" id="S13T1U201">c</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="21,26" id="srcline26">26</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,27" id="srcline27">27</a></span><span class="line">        <span class="comment">%Returns a NaN if a and b come with 1e-12 of each other before</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,28" id="srcline28">28</a></span><span class="line">        <span class="comment">%convergence</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,29" id="srcline29">29</a></span><span class="line">        <span class="keyword">if</span> <span class="mxinfo " id="T16:U155"><span class="mxinfo " id="T1:U156"><span class="var type1" id="S9T1U206">b</span>-<span class="var type1" id="S8T1U207">a</span></span> &lt; <span class="mxinfo " id="T1:U159">1e-12</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="21,30" id="srcline30">30</a></span><span class="line">            <span class="mxinfo " id="T1:U160"><span class="var type1" id="S2T1U211">x</span> = <span class="mxinfo " id="T1:U162">NaN</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="21,31" id="srcline31">31</a></span><span class="line">            <span class="keyword">return</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,32" id="srcline32">32</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,33" id="srcline33">33</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="21,34" id="srcline34">34</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
