<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="62,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1U3">J</span>, <span class="var type1" id="S3T8U4">mfiExp</span>, <span class="var type1" id="S4T9U5">mfiExpPre</span>] = Error(<span class="var type1" id="S5T10U8">Rtot</span>, <span class="var type1" id="S6T3U9">Kd</span>, <span class="var type1" id="S7T4U10">mfiAdjMean</span>, <span class="var type1" id="S8T5U11">v</span>, <span class="var type1" id="S9T6U12">biCoefMat</span>, <span class="var type1" id="S10T5U13">tnpbsa</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="62,2" id="srcline2"> 2</a></span><span class="line">    <span class="comment">% If error is called with Rtot being a single value, assume we want to</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,3" id="srcline3"> 3</a></span><span class="line">    <span class="comment">% have constant expression across all the receptors</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,4" id="srcline4"> 4</a></span><span class="line">    <span class="keyword">if</span> numel(<span class="var type1" id="S5T10U19">Rtot</span>) == 2</span></span>
<span class="srcline"><span class="lineno"><a href="62,5" id="srcline5"> 5</a></span><span class="line">        <span class="var type0" id="S5T0U23">Rtot</span> = [<span class="var type0" id="S5T0U28">Rtot</span>(1) * ones(6,1); <span class="var type0" id="S5T0U36">Rtot</span>(2)];</span></span>
<span class="srcline"><span class="lineno"><a href="62,6" id="srcline6"> 6</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,7" id="srcline7"> 7</a></span><span class="line">    <span class="comment">%Convert from log scale</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,8" id="srcline8"> 8</a></span><span class="line">    <span class="mxinfo " id="T10:U11"><span class="var type1" id="S5T10U40">Rtot</span> = <span class="mxinfo " id="T10:U13"><span class="mxinfo " id="T1:U14">10</span>.^<span class="var type1" id="S5T10U43">Rtot</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="62,9" id="srcline9"> 9</a></span><span class="line">    <span class="mxinfo " id="T1:U16"><span class="var type1" id="S13T1U46">Kx</span> = <span class="mxinfo " id="T1:U18"><span class="var type1" id="S5T10U48">Rtot</span>(<span class="mxinfo " id="T12:U20">7</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="62,10" id="srcline10">10</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="62,11" id="srcline11">11</a></span><span class="line">    <span class="comment">%Get expected value of MFIs from Equation 7 from Stone</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,12" id="srcline12">12</a></span><span class="line">    <span class="mxinfo " id="T9:U21"><span class="var type1" id="S4T9U52">mfiExpPre</span> = <span class="mxinfo " id="T9:U23">zeros(<span class="mxinfo " id="T1:U24">6</span>,<span class="mxinfo " id="T1:U25">8</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="62,13" id="srcline13">13</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S15T1U59">j</span> = <span class="mxinfo " id="T1:U27">1</span>:6</span></span>
<span class="srcline"><span class="lineno"><a href="62,14" id="srcline14">14</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S16T1U65">k</span> = <span class="mxinfo " id="T1:U29">1</span>:4</span></span>
<span class="srcline"><span class="lineno"><a href="62,15" id="srcline15">15</a></span><span class="line">            <span class="mxinfo " id="T1:U30"><span class="mxinfo " id="T1:U31"><span class="var type1" id="S4T9U72">mfiExpPre</span>(<span class="var type1" id="S15T1U73">j</span>,<span class="var type1" id="S16T1U74">k</span>)</span> = <span class="mxinfo " id="T1:U35"><span class="fcn" id="F153N5:B76">StoneSolver</span>(<span class="mxinfo " id="T1:U36"><span class="var type1" id="S5T10U78">Rtot</span>(<span class="var type1" id="S15T1U79">j</span>)</span>,<span class="var type1" id="S13T1U80">Kx</span>,<span class="mxinfo " id="T1:U40"><span class="var type1" id="S8T5U82">v</span>(<span class="mxinfo " id="T12:U42">1</span>)</span>,<span class="mxinfo " id="T1:U43"><span class="var type1" id="S6T3U85">Kd</span>(<span class="var type1" id="S15T1U86">j</span>,<span class="var type1" id="S16T1U87">k</span>)</span>,<span class="mxinfo " id="T1:U47"><span class="var type1" id="S10T5U89">tnpbsa</span>(<span class="mxinfo " id="T12:U49">1</span>)</span>,<span class="var type1" id="S9T6U91">biCoefMat</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="62,16" id="srcline16">16</a></span><span class="line">            <span class="mxinfo " id="T1:U51"><span class="mxinfo " id="T1:U52"><span class="var type1" id="S4T9U95">mfiExpPre</span>(<span class="var type1" id="S15T1U96">j</span>,<span class="mxinfo " id="T1:U55"><span class="var type1" id="S16T1U98">k</span>+<span class="mxinfo " id="T1:U57">4</span></span>)</span> = <span class="mxinfo " id="T1:U58"><span class="fcn" id="F153N5:B101">StoneSolver</span>(<span class="mxinfo " id="T1:U59"><span class="var type1" id="S5T10U103">Rtot</span>(<span class="var type1" id="S15T1U104">j</span>)</span>,<span class="var type1" id="S13T1U105">Kx</span>,<span class="mxinfo " id="T1:U63"><span class="var type1" id="S8T5U107">v</span>(<span class="mxinfo " id="T12:U65">2</span>)</span>,<span class="mxinfo " id="T1:U66"><span class="var type1" id="S6T3U110">Kd</span>(<span class="var type1" id="S15T1U111">j</span>,<span class="var type1" id="S16T1U112">k</span>)</span>,<span class="mxinfo " id="T1:U70"><span class="var type1" id="S10T5U114">tnpbsa</span>(<span class="mxinfo " id="T12:U72">2</span>)</span>,<span class="var type1" id="S9T6U116">biCoefMat</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="62,17" id="srcline17">17</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,18" id="srcline18">18</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,19" id="srcline19">19</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="62,20" id="srcline20">20</a></span><span class="line">    <span class="comment">%Check for undefined values (errors from ReqFuncSolver)</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,21" id="srcline21">21</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T11:U74">max(<span class="mxinfo " id="T45:U75">max(<span class="mxinfo " id="T42:U76"><span class="var type1" id="S4T9U124">mfiExpPre</span> == <span class="mxinfo " id="T1:U78">-<span class="mxinfo " id="T1:U79">1</span></span></span>)</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,22" id="srcline22">22</a></span><span class="line">        <span class="mxinfo " id="T1:U80"><span class="var type1" id="S2T1U129">J</span> = <span class="mxinfo " id="T1:U82">1e8</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="62,23" id="srcline23">23</a></span><span class="line">        <span class="mxinfo " id="T9:U83"><span class="var type1" id="S4T9U133">mfiExpPre</span> = <span class="mxinfo " id="T9:U85">-<span class="mxinfo " id="T9:U86">ones(<span class="mxinfo " id="T1:U87">6</span>,<span class="mxinfo " id="T1:U88">8</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="62,24" id="srcline24">24</a></span><span class="line">        <span class="mxinfo " id="T8:U89"><span class="var type1" id="S3T8U141">mfiExp</span> = <span class="mxinfo " id="T9:U91">-<span class="mxinfo " id="T9:U92">ones(<span class="mxinfo " id="T1:U93">6</span>,<span class="mxinfo " id="T1:U94">8</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="62,25" id="srcline25">25</a></span><span class="line">        <span class="keyword">return</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,26" id="srcline26">26</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,27" id="srcline27">27</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="62,28" id="srcline28">28</a></span><span class="line">    <span class="comment">%Create array of expected values to calculate residuals</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,29" id="srcline29">29</a></span><span class="line">    <span class="mxinfo " id="T8:U95"><span class="var type1" id="S3T8U150">mfiExp</span> = <span class="mxinfo " id="T4:U97">zeros(<span class="mxinfo " id="T1:U98">24</span>,<span class="mxinfo " id="T1:U99">8</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="62,30" id="srcline30">30</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S15T1U157">j</span> = <span class="mxinfo " id="T1:U101">1</span>:6</span></span>
<span class="srcline"><span class="lineno"><a href="62,31" id="srcline31">31</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S16T1U163">k</span> = <span class="mxinfo " id="T1:U103">1</span>:4</span></span>
<span class="srcline"><span class="lineno"><a href="62,32" id="srcline32">32</a></span><span class="line">            <span class="mxinfo " id="T47:U104"><span class="mxinfo " id="T47:U105"><span class="var type1" id="S3T8U170">mfiExp</span>((<span class="mxinfo " id="T1:U107"><span class="mxinfo " id="T1:U108"><span class="mxinfo " id="T1:U109">4</span>*(<span class="mxinfo " id="T1:U110"><span class="var type1" id="S15T1U177">j</span>-<span class="mxinfo " id="T1:U112">1</span></span>)</span>+<span class="var type1" id="S16T1U179">k</span></span>),<span class="mxinfo " id="T47:U114"><span class="mxinfo " id="T1:U115">1</span>:<span class="mxinfo " id="T1:U116">4</span></span>)</span> = <span class="mxinfo " id="T47:U117"><span class="mxinfo " id="T1:U118"><span class="var type1" id="S4T9U185">mfiExpPre</span>(<span class="var type1" id="S15T1U186">j</span>,<span class="var type1" id="S16T1U187">k</span>)</span>*<span class="mxinfo " id="T47:U122">ones(1,4)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="62,33" id="srcline33">33</a></span><span class="line">            <span class="mxinfo " id="T47:U123"><span class="mxinfo " id="T47:U124"><span class="var type1" id="S3T8U195">mfiExp</span>((<span class="mxinfo " id="T1:U126"><span class="mxinfo " id="T1:U127"><span class="mxinfo " id="T1:U128">4</span>*(<span class="mxinfo " id="T1:U129"><span class="var type1" id="S15T1U202">j</span>-<span class="mxinfo " id="T1:U131">1</span></span>)</span>+<span class="var type1" id="S16T1U204">k</span></span>),<span class="mxinfo " id="T47:U133"><span class="mxinfo " id="T1:U134">5</span>:<span class="mxinfo " id="T1:U135">8</span></span>)</span> = <span class="mxinfo " id="T47:U136"><span class="mxinfo " id="T1:U137"><span class="var type1" id="S4T9U210">mfiExpPre</span>(<span class="var type1" id="S15T1U211">j</span>,<span class="mxinfo " id="T1:U140"><span class="var type1" id="S16T1U213">k</span>+<span class="mxinfo " id="T1:U142">4</span></span>)</span>*<span class="mxinfo " id="T47:U143">ones(1,4)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="62,34" id="srcline34">34</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,35" id="srcline35">35</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,36" id="srcline36">36</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="62,37" id="srcline37">37</a></span><span class="line">    <span class="comment">%Error</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,38" id="srcline38">38</a></span><span class="line">    <span class="mxinfo " id="T1:U144"><span class="var type1" id="S2T1U221">J</span> = <span class="mxinfo " id="T1:U146">nansum(<span class="mxinfo " id="T48:U147">nansum(<span class="mxinfo " id="T4:U148">(<span class="mxinfo " id="T4:U149"><span class="var type1" id="S3T8U229">mfiExp</span>-<span class="var type1" id="S7T4U230">mfiAdjMean</span></span>).^2</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="62,39" id="srcline39">39</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
