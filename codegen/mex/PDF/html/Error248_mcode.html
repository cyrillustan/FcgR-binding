<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="62,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1U3">J</span>, <span class="var type1" id="S3T8U4">mfiExp</span>, <span class="var type1" id="S4T9U5">mfiExpPre</span>] = Error(<span class="var type1" id="S5T13U8">Rtot</span>, <span class="var type1" id="S6T3U9">Kd</span>, <span class="var type1" id="S7T4U10">mfiAdjMean</span>, <span class="var type1" id="S8T6U11">v</span>, <span class="var type1" id="S9T5U12">biCoefMat</span>, <span class="var type1" id="S10T6U13">tnpbsa</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="62,2" id="srcline2"> 2</a></span><span class="line">    <span class="comment">% If error is called with Rtot being a single value, assume we want to</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,3" id="srcline3"> 3</a></span><span class="line">    <span class="comment">% have constant expression across all the receptors</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,4" id="srcline4"> 4</a></span><span class="line">    <span class="keyword">if</span> numel(<span class="var type1" id="S5T13U19">Rtot</span>) == 4</span></span>
<span class="srcline"><span class="lineno"><a href="62,5" id="srcline5"> 5</a></span><span class="line">        <span class="var type0" id="S5T0U23">Rtot</span> = [<span class="var type0" id="S5T0U28">Rtot</span>(1) * ones(6,1); <span class="var type0" id="S5T0U36">Rtot</span>(2:4)];</span></span>
<span class="srcline"><span class="lineno"><a href="62,6" id="srcline6"> 6</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,7" id="srcline7"> 7</a></span><span class="line">    <span class="comment">%Convert from log scale</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,8" id="srcline8"> 8</a></span><span class="line">    <span class="mxinfo " id="T13:U11"><span class="var type1" id="S5T13U42">Rtot</span> = <span class="mxinfo " id="T13:U13"><span class="mxinfo " id="T1:U14">10</span>.^<span class="var type1" id="S5T13U45">Rtot</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="62,9" id="srcline9"> 9</a></span><span class="line">    <span class="mxinfo " id="T1:U16"><span class="var type1" id="S13T1U48">Kx</span> = <span class="mxinfo " id="T1:U18"><span class="var type1" id="S5T13U50">Rtot</span>(<span class="mxinfo " id="T12:U20">7</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="62,10" id="srcline10">10</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="62,11" id="srcline11">11</a></span><span class="line">    <span class="comment">%Get expected value of MFIs (before conversion factors) from Equation 7</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,12" id="srcline12">12</a></span><span class="line">    <span class="comment">%from Stone</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,13" id="srcline13">13</a></span><span class="line">    <span class="mxinfo " id="T9:U21"><span class="var type1" id="S14T9U54">mfiExpPrePre</span> = <span class="mxinfo " id="T9:U23">zeros(<span class="mxinfo " id="T1:U24">6</span>,<span class="mxinfo " id="T1:U25">8</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="62,14" id="srcline14">14</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S16T1U61">j</span> = <span class="mxinfo " id="T1:U27">1</span>:6</span></span>
<span class="srcline"><span class="lineno"><a href="62,15" id="srcline15">15</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S17T1U67">k</span> = <span class="mxinfo " id="T1:U29">1</span>:4</span></span>
<span class="srcline"><span class="lineno"><a href="62,16" id="srcline16">16</a></span><span class="line">            <span class="mxinfo " id="T1:U30"><span class="mxinfo " id="T1:U31"><span class="var type1" id="S14T9U74">mfiExpPrePre</span>(<span class="var type1" id="S16T1U75">j</span>,<span class="var type1" id="S17T1U76">k</span>)</span> = <span class="mxinfo " id="T1:U35"><span class="fcn" id="F153N6:B78">StoneSolver</span>(<span class="mxinfo " id="T1:U36"><span class="var type1" id="S5T13U80">Rtot</span>(<span class="var type1" id="S16T1U81">j</span>)</span>,<span class="var type1" id="S13T1U82">Kx</span>,<span class="mxinfo " id="T1:U40"><span class="var type1" id="S8T6U84">v</span>(<span class="mxinfo " id="T12:U42">1</span>)</span>,<span class="mxinfo " id="T1:U43"><span class="var type1" id="S6T3U87">Kd</span>(<span class="var type1" id="S16T1U88">j</span>,<span class="var type1" id="S17T1U89">k</span>)</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,17" id="srcline17">17</a></span><span class="line">                <span class="mxinfo " id="T1:U47"><span class="var type1" id="S10T6U91">tnpbsa</span>(<span class="mxinfo " id="T12:U49">1</span>)</span>,<span class="var type1" id="S9T5U93">biCoefMat</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="62,18" id="srcline18">18</a></span><span class="line">            <span class="mxinfo " id="T1:U51"><span class="mxinfo " id="T1:U52"><span class="var type1" id="S14T9U97">mfiExpPrePre</span>(<span class="var type1" id="S16T1U98">j</span>,<span class="mxinfo " id="T1:U55"><span class="var type1" id="S17T1U100">k</span>+<span class="mxinfo " id="T1:U57">4</span></span>)</span> = <span class="mxinfo " id="T1:U58"><span class="fcn" id="F153N6:B103">StoneSolver</span>(<span class="mxinfo " id="T1:U59"><span class="var type1" id="S5T13U105">Rtot</span>(<span class="var type1" id="S16T1U106">j</span>)</span>,<span class="var type1" id="S13T1U107">Kx</span>,<span class="mxinfo " id="T1:U63"><span class="var type1" id="S8T6U109">v</span>(<span class="mxinfo " id="T12:U65">2</span>)</span>,<span class="mxinfo " id="T1:U66"><span class="var type1" id="S6T3U112">Kd</span>(<span class="var type1" id="S16T1U113">j</span>,<span class="var type1" id="S17T1U114">k</span>)</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,19" id="srcline19">19</a></span><span class="line">                <span class="mxinfo " id="T1:U70"><span class="var type1" id="S10T6U116">tnpbsa</span>(<span class="mxinfo " id="T12:U72">2</span>)</span>,<span class="var type1" id="S9T5U118">biCoefMat</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="62,20" id="srcline20">20</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,21" id="srcline21">21</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,22" id="srcline22">22</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="62,23" id="srcline23">23</a></span><span class="line">    <span class="comment">%Multiply by conversion factors</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,24" id="srcline24">24</a></span><span class="line">    <span class="mxinfo " id="T9:U74"><span class="var type1" id="S4T9U121">mfiExpPre</span> = <span class="mxinfo " id="T9:U76"><span class="mxinfo " id="T1:U77"><span class="var type1" id="S5T13U124">Rtot</span>(<span class="mxinfo " id="T12:U79">8</span>)</span>*<span class="var type1" id="S14T9U126">mfiExpPrePre</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="62,25" id="srcline25">25</a></span><span class="line">    <span class="mxinfo " id="T3:U81"><span class="mxinfo " id="T3:U82"><span class="var type1" id="S4T9U130">mfiExpPre</span>(<span class="mxinfo " id="T50:U84">:</span>,<span class="mxinfo " id="T51:U85">5:8</span>)</span> = <span class="mxinfo " id="T3:U86"><span class="mxinfo " id="T1:U87"><span class="var type1" id="S5T13U137">Rtot</span>(<span class="mxinfo " id="T12:U89">9</span>)</span>*<span class="mxinfo " id="T3:U90"><span class="var type1" id="S14T9U140">mfiExpPrePre</span>(<span class="mxinfo " id="T50:U92">:</span>,<span class="mxinfo " id="T51:U93">5:8</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="62,26" id="srcline26">26</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="62,27" id="srcline27">27</a></span><span class="line">    <span class="comment">%Check for undefined values (errors from ReqFuncSolver)</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,28" id="srcline28">28</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T11:U94">max(<span class="mxinfo " id="T46:U95">max(<span class="mxinfo " id="T43:U96"><span class="var type1" id="S4T9U152">mfiExpPre</span> == <span class="mxinfo " id="T1:U98">-<span class="mxinfo " id="T1:U99">1</span></span></span>)</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,29" id="srcline29">29</a></span><span class="line">        <span class="mxinfo " id="T1:U100"><span class="var type1" id="S2T1U157">J</span> = <span class="mxinfo " id="T1:U102">1e8</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="62,30" id="srcline30">30</a></span><span class="line">        <span class="mxinfo " id="T9:U103"><span class="var type1" id="S4T9U161">mfiExpPre</span> = <span class="mxinfo " id="T9:U105">-<span class="mxinfo " id="T9:U106">ones(<span class="mxinfo " id="T1:U107">6</span>,<span class="mxinfo " id="T1:U108">8</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="62,31" id="srcline31">31</a></span><span class="line">        <span class="mxinfo " id="T8:U109"><span class="var type1" id="S3T8U169">mfiExp</span> = <span class="mxinfo " id="T9:U111">-<span class="mxinfo " id="T9:U112">ones(<span class="mxinfo " id="T1:U113">6</span>,<span class="mxinfo " id="T1:U114">8</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="62,32" id="srcline32">32</a></span><span class="line">        <span class="keyword">return</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,33" id="srcline33">33</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,34" id="srcline34">34</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="62,35" id="srcline35">35</a></span><span class="line">    <span class="comment">%Create array of expected values to calculate residuals</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,36" id="srcline36">36</a></span><span class="line">    <span class="mxinfo " id="T8:U115"><span class="var type1" id="S3T8U178">mfiExp</span> = <span class="mxinfo " id="T4:U117">zeros(<span class="mxinfo " id="T1:U118">24</span>,<span class="mxinfo " id="T1:U119">8</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="62,37" id="srcline37">37</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S16T1U185">j</span> = <span class="mxinfo " id="T1:U121">1</span>:6</span></span>
<span class="srcline"><span class="lineno"><a href="62,38" id="srcline38">38</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S17T1U191">k</span> = <span class="mxinfo " id="T1:U123">1</span>:4</span></span>
<span class="srcline"><span class="lineno"><a href="62,39" id="srcline39">39</a></span><span class="line">            <span class="mxinfo " id="T48:U124"><span class="mxinfo " id="T48:U125"><span class="var type1" id="S3T8U198">mfiExp</span>((<span class="mxinfo " id="T1:U127"><span class="mxinfo " id="T1:U128"><span class="mxinfo " id="T1:U129">4</span>*(<span class="mxinfo " id="T1:U130"><span class="var type1" id="S16T1U205">j</span>-<span class="mxinfo " id="T1:U132">1</span></span>)</span>+<span class="var type1" id="S17T1U207">k</span></span>),<span class="mxinfo " id="T48:U134"><span class="mxinfo " id="T1:U135">1</span>:<span class="mxinfo " id="T1:U136">4</span></span>)</span> = <span class="mxinfo " id="T48:U137"><span class="mxinfo " id="T1:U138"><span class="var type1" id="S4T9U213">mfiExpPre</span>(<span class="var type1" id="S16T1U214">j</span>,<span class="var type1" id="S17T1U215">k</span>)</span>*<span class="mxinfo " id="T48:U142">ones(1,4)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="62,40" id="srcline40">40</a></span><span class="line">            <span class="mxinfo " id="T48:U143"><span class="mxinfo " id="T48:U144"><span class="var type1" id="S3T8U223">mfiExp</span>((<span class="mxinfo " id="T1:U146"><span class="mxinfo " id="T1:U147"><span class="mxinfo " id="T1:U148">4</span>*(<span class="mxinfo " id="T1:U149"><span class="var type1" id="S16T1U230">j</span>-<span class="mxinfo " id="T1:U151">1</span></span>)</span>+<span class="var type1" id="S17T1U232">k</span></span>),<span class="mxinfo " id="T48:U153"><span class="mxinfo " id="T1:U154">5</span>:<span class="mxinfo " id="T1:U155">8</span></span>)</span> = <span class="mxinfo " id="T48:U156"><span class="mxinfo " id="T1:U157"><span class="var type1" id="S4T9U238">mfiExpPre</span>(<span class="var type1" id="S16T1U239">j</span>,<span class="mxinfo " id="T1:U160"><span class="var type1" id="S17T1U241">k</span>+<span class="mxinfo " id="T1:U162">4</span></span>)</span>*<span class="mxinfo " id="T48:U163">ones(1,4)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="62,41" id="srcline41">41</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,42" id="srcline42">42</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,43" id="srcline43">43</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="62,44" id="srcline44">44</a></span><span class="line">    <span class="comment">%Error</span></span></span>
<span class="srcline"><span class="lineno"><a href="62,45" id="srcline45">45</a></span><span class="line">    <span class="mxinfo " id="T1:U164"><span class="var type1" id="S2T1U249">J</span> = <span class="mxinfo " id="T1:U166">nansum(<span class="mxinfo " id="T49:U167">nansum(<span class="mxinfo " id="T4:U168">(<span class="mxinfo " id="T4:U169"><span class="var type1" id="S3T8U257">mfiExp</span>-<span class="var type1" id="S7T4U258">mfiAdjMean</span></span>).^2</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="62,46" id="srcline46">46</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
