<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="69,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T3U3">J</span>, <span class="var type1" id="S3T59U4">mfiExp</span>, <span class="var type1" id="S4T51U5">mfiExpPre</span>] = Error(<span class="var type1" id="S5T32U8">Rtot</span>, <span class="var type1" id="S6T4U9">Kd</span>, <span class="var type1" id="S7T6U10">mfiAdjMean</span>, <span class="var type1" id="S8T5U11">v</span>, <span class="var type1" id="S9T9U12">biCoefMat</span>, <span class="var type1" id="S10T5U13">tnpbsa</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="69,2" id="srcline2"> 2</a></span><span class="line">    <span class="comment">% If error is called with Rtot being a single value, assume we want to</span></span></span>
<span class="srcline"><span class="lineno"><a href="69,3" id="srcline3"> 3</a></span><span class="line">    <span class="comment">% have constant expression across all the receptors</span></span></span>
<span class="srcline"><span class="lineno"><a href="69,4" id="srcline4"> 4</a></span><span class="line">    <span class="keyword">if</span> numel(<span class="var type1" id="S5T32U19">Rtot</span>) == 4</span></span>
<span class="srcline"><span class="lineno"><a href="69,5" id="srcline5"> 5</a></span><span class="line">        <span class="var type0" id="S5T0U23">Rtot</span> = [<span class="var type0" id="S5T0U28">Rtot</span>(1) * ones(6,1); <span class="var type0" id="S5T0U36">Rtot</span>(2:4)];</span></span>
<span class="srcline"><span class="lineno"><a href="69,6" id="srcline6"> 6</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="69,7" id="srcline7"> 7</a></span><span class="line">    <span class="comment">%Convert from log scale</span></span></span>
<span class="srcline"><span class="lineno"><a href="69,8" id="srcline8"> 8</a></span><span class="line">    <span class="mxinfo " id="T32:U11"><span class="var type1" id="S5T32U42">Rtot</span> = <span class="mxinfo " id="T32:U13"><span class="mxinfo " id="T3:U14">10</span>.^<span class="var type1" id="S5T32U45">Rtot</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="69,9" id="srcline9"> 9</a></span><span class="line">    <span class="mxinfo " id="T3:U16"><span class="var type1" id="S13T3U48">Kx</span> = <span class="mxinfo " id="T3:U18"><span class="var type1" id="S5T32U50">Rtot</span>(<span class="mxinfo " id="T10:U20">7</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="69,10" id="srcline10">10</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="69,11" id="srcline11">11</a></span><span class="line">    <span class="comment">%Get expected value of MFIs (before conversion factors) from Equation 7</span></span></span>
<span class="srcline"><span class="lineno"><a href="69,12" id="srcline12">12</a></span><span class="line">    <span class="comment">%from Stone</span></span></span>
<span class="srcline"><span class="lineno"><a href="69,13" id="srcline13">13</a></span><span class="line">    <span class="mxinfo " id="T51:U21"><span class="var type1" id="S14T51U54">mfiExpPrePre</span> = <span class="mxinfo " id="T51:U23">zeros(<span class="mxinfo " id="T3:U24">6</span>,<span class="mxinfo " id="T3:U25">8</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="69,14" id="srcline14">14</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S16T3U61">j</span> = <span class="mxinfo " id="T3:U27">1</span>:6</span></span>
<span class="srcline"><span class="lineno"><a href="69,15" id="srcline15">15</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S17T3U67">k</span> = <span class="mxinfo " id="T3:U29">1</span>:4</span></span>
<span class="srcline"><span class="lineno"><a href="69,16" id="srcline16">16</a></span><span class="line">            <span class="mxinfo " id="T3:U30"><span class="mxinfo " id="T3:U31"><span class="var type1" id="S14T51U74">mfiExpPrePre</span>(<span class="var type1" id="S16T3U75">j</span>,<span class="var type1" id="S17T3U76">k</span>)</span> = <span class="mxinfo " id="T3:U35"><span class="fcn" id="F179N8:B78">StoneSolver</span>(<span class="mxinfo " id="T3:U36"><span class="var type1" id="S5T32U80">Rtot</span>(<span class="var type1" id="S16T3U81">j</span>)</span>,<span class="var type1" id="S13T3U82">Kx</span>,<span class="mxinfo " id="T3:U40"><span class="var type1" id="S8T5U84">v</span>(<span class="mxinfo " id="T10:U42">1</span>)</span>,<span class="mxinfo " id="T3:U43"><span class="var type1" id="S6T4U87">Kd</span>(<span class="var type1" id="S16T3U88">j</span>,<span class="var type1" id="S17T3U89">k</span>)</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="69,17" id="srcline17">17</a></span><span class="line">                <span class="mxinfo " id="T3:U47"><span class="var type1" id="S10T5U91">tnpbsa</span>(<span class="mxinfo " id="T10:U49">1</span>)</span>,<span class="var type1" id="S9T9U93">biCoefMat</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="69,18" id="srcline18">18</a></span><span class="line">            <span class="mxinfo " id="T3:U51"><span class="mxinfo " id="T3:U52"><span class="var type1" id="S14T51U97">mfiExpPrePre</span>(<span class="var type1" id="S16T3U98">j</span>,<span class="mxinfo " id="T3:U55"><span class="var type1" id="S17T3U100">k</span>+<span class="mxinfo " id="T3:U57">4</span></span>)</span> = <span class="mxinfo " id="T3:U58"><span class="fcn" id="F179N8:B103">StoneSolver</span>(<span class="mxinfo " id="T3:U59"><span class="var type1" id="S5T32U105">Rtot</span>(<span class="var type1" id="S16T3U106">j</span>)</span>,<span class="var type1" id="S13T3U107">Kx</span>,<span class="mxinfo " id="T3:U63"><span class="var type1" id="S8T5U109">v</span>(<span class="mxinfo " id="T10:U65">2</span>)</span>,<span class="mxinfo " id="T3:U66"><span class="var type1" id="S6T4U112">Kd</span>(<span class="var type1" id="S16T3U113">j</span>,<span class="var type1" id="S17T3U114">k</span>)</span>, <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="69,19" id="srcline19">19</a></span><span class="line">                <span class="mxinfo " id="T3:U70"><span class="var type1" id="S10T5U116">tnpbsa</span>(<span class="mxinfo " id="T10:U72">2</span>)</span>,<span class="var type1" id="S9T9U118">biCoefMat</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="69,20" id="srcline20">20</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="69,21" id="srcline21">21</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="69,22" id="srcline22">22</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="69,23" id="srcline23">23</a></span><span class="line">    <span class="comment">%Multiply by conversion factors</span></span></span>
<span class="srcline"><span class="lineno"><a href="69,24" id="srcline24">24</a></span><span class="line">    <span class="mxinfo " id="T51:U74"><span class="var type1" id="S4T51U121">mfiExpPre</span> = <span class="mxinfo " id="T51:U76"><span class="mxinfo " id="T3:U77"><span class="var type1" id="S5T32U124">Rtot</span>(<span class="mxinfo " id="T10:U79">8</span>)</span>*<span class="var type1" id="S14T51U126">mfiExpPrePre</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="69,25" id="srcline25">25</a></span><span class="line">    <span class="mxinfo " id="T4:U81"><span class="mxinfo " id="T4:U82"><span class="var type1" id="S4T51U130">mfiExpPre</span>(<span class="mxinfo " id="T60:U84">:</span>,<span class="mxinfo " id="T61:U85">5:8</span>)</span> = <span class="mxinfo " id="T4:U86"><span class="mxinfo " id="T3:U87"><span class="var type1" id="S5T32U137">Rtot</span>(<span class="mxinfo " id="T10:U89">9</span>)</span>*<span class="mxinfo " id="T4:U90"><span class="var type1" id="S14T51U140">mfiExpPrePre</span>(<span class="mxinfo " id="T60:U92">:</span>,<span class="mxinfo " id="T61:U93">5:8</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="69,26" id="srcline26">26</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="69,27" id="srcline27">27</a></span><span class="line">    <span class="comment">%Check for undefined values (errors from ReqFuncSolver)</span></span></span>
<span class="srcline"><span class="lineno"><a href="69,28" id="srcline28">28</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T17:U94">max(<span class="mxinfo " id="T55:U95">max(<span class="mxinfo " id="T52:U96"><span class="var type1" id="S4T51U152">mfiExpPre</span> == <span class="mxinfo " id="T3:U98">-<span class="mxinfo " id="T3:U99">1</span></span></span>)</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="69,29" id="srcline29">29</a></span><span class="line">        <span class="mxinfo " id="T3:U100"><span class="var type1" id="S2T3U157">J</span> = <span class="mxinfo " id="T3:U102">1e8</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="69,30" id="srcline30">30</a></span><span class="line">        <span class="mxinfo " id="T51:U103"><span class="var type1" id="S4T51U161">mfiExpPre</span> = <span class="mxinfo " id="T51:U105">-<span class="mxinfo " id="T51:U106">ones(<span class="mxinfo " id="T3:U107">6</span>,<span class="mxinfo " id="T3:U108">8</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="69,31" id="srcline31">31</a></span><span class="line">        <span class="mxinfo " id="T59:U109"><span class="var type1" id="S3T59U169">mfiExp</span> = <span class="mxinfo " id="T51:U111">-<span class="mxinfo " id="T51:U112">ones(<span class="mxinfo " id="T3:U113">6</span>,<span class="mxinfo " id="T3:U114">8</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="69,32" id="srcline32">32</a></span><span class="line">        <span class="keyword">return</span></span></span>
<span class="srcline"><span class="lineno"><a href="69,33" id="srcline33">33</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="69,34" id="srcline34">34</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="69,35" id="srcline35">35</a></span><span class="line">    <span class="comment">%Create array of expected values to calculate residuals</span></span></span>
<span class="srcline"><span class="lineno"><a href="69,36" id="srcline36">36</a></span><span class="line">    <span class="mxinfo " id="T59:U115"><span class="var type1" id="S3T59U178">mfiExp</span> = <span class="mxinfo " id="T6:U117">zeros(<span class="mxinfo " id="T3:U118">24</span>,<span class="mxinfo " id="T3:U119">8</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="69,37" id="srcline37">37</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S16T3U185">j</span> = <span class="mxinfo " id="T3:U121">1</span>:6</span></span>
<span class="srcline"><span class="lineno"><a href="69,38" id="srcline38">38</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S17T3U191">k</span> = <span class="mxinfo " id="T3:U123">1</span>:4</span></span>
<span class="srcline"><span class="lineno"><a href="69,39" id="srcline39">39</a></span><span class="line">            <span class="mxinfo " id="T57:U124"><span class="mxinfo " id="T57:U125"><span class="var type1" id="S3T59U198">mfiExp</span>((<span class="mxinfo " id="T3:U127"><span class="mxinfo " id="T3:U128"><span class="mxinfo " id="T3:U129">4</span>*(<span class="mxinfo " id="T3:U130"><span class="var type1" id="S16T3U205">j</span>-<span class="mxinfo " id="T3:U132">1</span></span>)</span>+<span class="var type1" id="S17T3U207">k</span></span>),<span class="mxinfo " id="T57:U134"><span class="mxinfo " id="T3:U135">1</span>:<span class="mxinfo " id="T3:U136">4</span></span>)</span> = <span class="mxinfo " id="T57:U137"><span class="mxinfo " id="T3:U138"><span class="var type1" id="S4T51U213">mfiExpPre</span>(<span class="var type1" id="S16T3U214">j</span>,<span class="var type1" id="S17T3U215">k</span>)</span>*<span class="mxinfo " id="T57:U142">ones(1,4)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="69,40" id="srcline40">40</a></span><span class="line">            <span class="mxinfo " id="T57:U143"><span class="mxinfo " id="T57:U144"><span class="var type1" id="S3T59U223">mfiExp</span>((<span class="mxinfo " id="T3:U146"><span class="mxinfo " id="T3:U147"><span class="mxinfo " id="T3:U148">4</span>*(<span class="mxinfo " id="T3:U149"><span class="var type1" id="S16T3U230">j</span>-<span class="mxinfo " id="T3:U151">1</span></span>)</span>+<span class="var type1" id="S17T3U232">k</span></span>),<span class="mxinfo " id="T57:U153"><span class="mxinfo " id="T3:U154">5</span>:<span class="mxinfo " id="T3:U155">8</span></span>)</span> = <span class="mxinfo " id="T57:U156"><span class="mxinfo " id="T3:U157"><span class="var type1" id="S4T51U238">mfiExpPre</span>(<span class="var type1" id="S16T3U239">j</span>,<span class="mxinfo " id="T3:U160"><span class="var type1" id="S17T3U241">k</span>+<span class="mxinfo " id="T3:U162">4</span></span>)</span>*<span class="mxinfo " id="T57:U163">ones(1,4)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="69,41" id="srcline41">41</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="69,42" id="srcline42">42</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="69,43" id="srcline43">43</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="69,44" id="srcline44">44</a></span><span class="line">    <span class="comment">%Error</span></span></span>
<span class="srcline"><span class="lineno"><a href="69,45" id="srcline45">45</a></span><span class="line">    <span class="mxinfo " id="T3:U164"><span class="var type1" id="S2T3U249">J</span> = <span class="mxinfo " id="T3:U166">nansum(<span class="mxinfo " id="T58:U167">nansum(<span class="mxinfo " id="T6:U168">(<span class="mxinfo " id="T6:U169"><span class="var type1" id="S3T59U257">mfiExp</span>-<span class="var type1" id="S7T6U258">mfiAdjMean</span></span>).^2</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="69,46" id="srcline46">46</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
