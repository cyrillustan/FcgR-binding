# Methods

All analysis was implemented in Python, and can be found at [https://github.com/meyer-lab/FcgR-binding](https://github.com/meyer-lab/FcgR-binding), release 1.0 (TODO: Add doi number).

## Immune complex binding measurement

Immune complex (IC) binding to human FcγRs was analyzed using Chinese hamster ovarian (CHO) cells stably expressing human FcγRs as previously described [@Lux:2013iv]. Receptor expression was quantified using antibodies against each FcγR and flow cytometry measurement as previously described [@Lux:2013iv]. Receptor expression was quantified in terms of absolute number through comparison to fluorescence standards (QSC microspheres, Bangs Labs). Briefly, ICs were generated by coincubation of 10 mg/ml human anti-TNP IgG and 5 mg/ml TNP-coupled BSA for 3 h with gentle shaking at room temperature. ICs were incubated with 100,000 CHO cells stably expressing human FcγRs for 1 h under gentle shaking at 4℃. Bound ICs were detected by flow cytometry using a PE-conjugated goat anti-human IgG F(ab')~2~ fragment at 0.5 mg/ml (Jackson ImmunoResearch Laboratories). Data were analyzed with Flow Cytometry Analysis Software (FlowJo) or FACSDiva Software.

## *In vivo* regression

Regression against *in vivo* efficacy of IgG treatments was performed by least-squares (`scipy.optimize.least_squares`). Each efficacy was presented as the percent reduction in the number of lung metastases quantified [@Nimmerjahn:2005hu]. To account for the limited range of this quantity (e.g. one cannot have a reduction of 200%), the regression was performed with a hyberbolic relationship, such that:

$$ y = F (X \cdot p) $$ {#eq:lsq}

where $F$ is the normal distribuion cumulative density function, with mean and standard deviation varied during fitting.

## Model

### Base model

The equilibrium binding of TNP-X-BSA to FcγRs was modeled using a two-parameter equilibrium model of multivalent ligand binding to monovalent receptors expressed uniformly on a cell surface [@Stone:2001fm; @Perelson:1980fs]. Within the model, binding is assumed to occur first according to a monovalent binding interaction governed by the individual binding site affinity $K_a$, and then through subsequent cross-linking events with equilibrium partitioning $K_x$.

Therefore, according to the model, the number of ligand bound $i$-valently to the cell at equilibrium, $v_{i,eq}$, can be found using the relation

$$ v_{i,eq} = {f\choose i} (K_x)^{i-1} {L_0}{K_a} \left(R_{eq}\right)^i. $$ {#eq:vieq}

Here, $f$ is the effective avidity of the ligand, $K_x$ is a cross-linking parameter with units of # per cell, $L_0$ is the concentration of ligand, and $R_{eq}$ is the number of unbound receptors at equilibrium. Consequently, the total number of ligand complexes bound at equilibrium is

$$ L_{bound} = \sum_{i=1}^{f} v_{i,eq} = \sum_{i=1}^{f} { f\choose i } (K_x)^{i-1} {L_0}{K_a} (R_{eq})^i. $$ {#eq:lbound}

$R_{eq}$ represents the quantity of unbound receptors, and is a function of $f$, $L_0$, $K_a$, $K_x$, and $R_{tot}$, the total number of receptors expressed on the cell surface. $R_{eq}$ can be solved for numerically using the relationship

$$ R_{tot} = R_{eq} \left(1+f {L_0}{K_D} (1+K_x R_{eq})^{f-1}\right) $$ {#eq:rtot}

when these parameters are known. As a consequence of [@eq:vieq], the number of receptors that are clustered with at least one other receptor at equilibrium ($R_{multi}$) can be found as follows:

$$ R_{multi} = \sum_{i=2}^{f} iv_{i,eq}. $$ {#eq:rmulti}

### Parameters and Assumptions

Association constants for all combinations of IgG and FcγR were obtained from previous experimental measurements [@Bruhns:2009kg]. In each replicate of Lux's assay, cells were coincubated with 5 µg/ml TNP-X-BSA. Because the molar masses of a 2,4,6-trinitrophenyl groups and of BSA are approximately 173 Da and 66430 Da, respectively, we represented the molar concentrations of TNP-4-BSA and TNP-26-BSA as 74 nM and 70 nM [@Lux:2013iv]. We also assumed that there were two different conversion factors between the number of ICs bound and MFI for TNP-4-BSA and TNP-26-BSA. Lastly, we assumed that, due to steric effects, the effective avidities of TNP-4-BSA and (especially) TNP-26-BSA might be different that their actual avidities. This required us, in total, to fit 11 parameters: the total expression level $R_{tot}$ for each FcγR, $K_x$, conversion factors from ligand bound to MFI for both TNP-BSAs, and effective avidities for both TNP-BSAs ($f_{4}$ and $f_{26}$, respectively).

### Specification for $K_x$

We represented $K_x$ as the product of $K_a$, the affinity between IgG species on the ligand and the FcγR species expressed, and a crosslinking coefficient, $K_x^*$ We allowed $K_x^*$ to vary between $10^{-25}$ and $10^3$, in order to provide no constraint on possible values. While $K_x$ was previously assumed to be constant [@Stone:2001fm], we noted that a constant value of $K_x$ must break down under certain regimes. Specifically, a constant value for $K_x$ is consistent with a high local concentration of ligand, leading to receptor-ligand binding determined more so by receptor accessibility via cell surface diffusion and other factors. However, at some limit of low affinity FcγR-IgG binding, $K_x$ must ultimately be reduced, and $K_x$ for interactions with zero affinity must equal zero. Further, detailed balance is only satisfied for cases with multiple receptors of differing affinity present when proportional to affinity. Therefore, we specified an effective $K_x$, equal to

$$ K_x = K_x^* K_a. $$ {#eq:kx}

As a consequence of this construction, $K_x$ becomes zero in the absence of binding and satisfies detailed balance.

### Model Fitting

We fit our model to binding measurements for each FcγR-IgG pair using an affine invariant Markov chain Monte Carlo sampler as implemented within the emcee package [@ForemanMackey:2013ux]. We assumed that the variance in each measurement was proportional to the true value. Therefore, we additionally fit a variance parameter $\sigma_1$. The likelihood of each measurement was calculated by comparison to a normal distribution with mean equal to the model prediction and standard deviation equal to the prediction times $\sigma_1$. We assayed the convergence of the Markov chain using the Geweke diagnostic and chain autocorrelation [@Geweke:1991tk]. The Geweke diagnostic was used to determine whether early and late segments of the Markov chain could have been sampled from the same probability distribution. Each walker's series of values for a particular parameter was treated as a single chain, upon which the diagnostic was evaluated.

In addition to immune complex binding, the receptor expression of each cell line was quantitatively measured. These measurements were treated similarly, with a separate variance parameter $\sigma_2$, and likelihood calculated using a normal distribution with mean equal to the predicted receptor expression and standard deviation equal to that prediction times $\sigma_2$. The overall likelihood of the model at each parameter set was calculated by the product of all individual likelihoods. The priors for each parameter were therefore otherwise specified to be uniform.
